<!doctype html>
<html lang="{{ page.lang | default: site.lang | default: "en" }}">

  {% include head.html %}

  <body>

    <div class="container pure-g">
      {%- assign cover_bg_color = site.cover_bg_color | default: "rgb(40, 73, 77)" -%}
      {%- assign cover_color    = site.cover_color    | default: "rgb(255, 255, 255)" -%}
      {%- assign cover_image    = site.cover_image -%}
      {%- if page.cover_bg_color -%}
        {%- assign cover_bg_color  = page.cover_bg_color -%}
      {%- endif -%}
      {%- if page.cover_color -%}
        {%- assign cover_color     = page.cover_color -%}
      {%- endif -%}
      {%- if page.cover_image -%}
        {%- assign cover_image     = page.cover_image -%}
      {%- endif -%}
      <div class="sidebar-left pure-u-1 pure-u-md-1-4" style="background-color: {{ cover_bg_color }}; color: {{ cover_color}}; {% if cover_image %}background-image: url({{ cover_image | relative_url }});{% endif %}">
        {%- include sidebar-left.html -%}
      </div>

      <!-- 
      메인 콘텐츠 영역과 오른쪽 사이드바를 정의
      pure-u-*는 Pure.css의 그리드 시스템을 사용하여 레이아웃을 구성합니다.

      <main>은 웹 표준에서 페이지의 주요 콘텐츠를 담는 태그
      Swup이 작동하려면, 페이지 전환 시 애니메이션으로 바뀔 컨테이너가 필요합니다.
      그 컨테이너가 바로 id="swup"입니다.
      
      class 속성
      content: 의미적 클래스 (컨텐츠 영역)

      pure-u-1: 모바일에서는 너비 100%

      pure-u-md-1-2: 중간 화면 이상에서는 너비 50%

      transition-fade: 페이지 전환 애니메이션 적용 클래스

      Swup은 **id="swup"**가 붙은 영역의 콘텐츠만 AJAX로 불러와서 교체하기 때문에,
      주요 콘텐츠 영역(main)에 붙여야 페이지 이동이 자연스럽게 보입니다.
      -->
      <main id="swup" class="content pure-u-1 pure-u-md-1-2 transition-fade">
        {%- include content.html -%}
      </main>
      <div class="sidebar-right pure-u-1 pure-u-md-1-4">
        {%- include sidebar-right.html -%}
      </div>
    </div>

    <!-- Swup 페이지 전환 라이브러리 -->
    <script src="https://unpkg.com/swup@4" defer></script>
    <!-- Swup 스크립트 플러그인: 페이지 전환 시 스크립트를 다시 실행 -->
    <script src="https://unpkg.com/@swup/scripts-plugin@2" defer></script>
    <script>
    document.addEventListener('DOMContentLoaded', function () {
      // Swup 초기화 및 플러그인 등록
      const swup = new Swup({
        plugins: [new SwupScriptsPlugin({
          // 새로 로드된 페이지의 스크립트를 head와 body 모두에서 다시 실행
          head: true,
          body: true
        })]
      });

      // 페이지가 교체되기 직전에 이전 페이지 스크립트 정리
      // will-replace는 더 이상 사용되지 않음 -> content:replace
      swup.hooks.before('content:replace', (visit) => {
        if (typeof window.cleanupPageScripts === 'function') {
          console.log('이전 페이지의 스크립트를 정리합니다.');
          window.cleanupPageScripts();
          // 다음 페이지에서 재사용되지 않도록 정리 함수를 삭제
          delete window.cleanupPageScripts;
        }
      });

      // 새 페이지가 표시된 후 스크립트 실행
      swup.hooks.on('page:view', (visit) => {
        if (typeof window.initializePageScripts === 'function') {
          console.log('새 페이지의 initializePageScripts()를 실행합니다.');
          window.initializePageScripts();
        }
      });
    });
    </script>
    <script async src="https://use.fontawesome.com/releases/v5.0.12/js/all.js"></script>

    {%- include scroll.html -%}

    {%- if page.math -%}
      {% include mathjax.html %}
    {%- endif -%}

    {%- if jekyll.environment == 'production' and site.google_analytics -%}
      {%- include google-analytics.html -%}
    {%- endif -%}
  </body>
</html>
